<html>

	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta content="yes" name="apple-mobile-web-app-capable">
		<meta content="black" name="apple-mobile-web-app-status-bar-style">
		<meta http-equiv="pragma" content="no-cache">
		<meta http-equiv="cache-control" content="no-cache">
		<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
		<meta http-equiv="Pragma" content="no-cache" />
		<meta http-equiv="Expires" content="0" />
		<link rel="stylesheet" href="__PUBLIC__/home/css/invite_code.css" media="all">
		<link rel="stylesheet" href="__PUBLIC__/home/css/alert.css" media="all">
		<script src="https://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
		<script type="text/javascript" src="__PUBLIC__/home/js/jquery.min.js"></script>
		<title>填写邀请码</title>
	</head>

	<body>
		<div class="container">
			<div class="page-content">
				<div class="test">
					<if condition="$data['pd']=='Y' ">
						<div class="yaocode">邀请码</div>
						<div class="title">请输入邀请人的邀请码！</div>
						<input type="text" id="yaoCode1" maxlength="6" class="code" value="{$data.invite}" readonly="true">
						<else />
						<div class="yaocode">邀请码</div>
						<div class="title">请输入邀请人的邀请码！</div>
						<input type="text" id="yaoCode" maxlength="6" class="code" value="">
						<button type="button" onclick="save()" class="btn">保存</button>
					</if>
				</div>
			</div>
		</div>
		<body>
			<script type="text/javascript">
				function save(){
					//弹框
					var toast = function(params) {
						var el = document.createElement("div");
						el.setAttribute("id", "toast");
						el.innerHTML = params.message;
						document.body.appendChild(el);
						el.classList.add("fadeIn");
						setTimeout(function() {
							el.classList.remove("fadeIn");
							el.classList.add("fadeOut");
							el.addEventListener("animationend", function() {
								el.classList.add("hide");
							});
						}, params.time);
					};
					var invitcode=$('#yaoCode').val();
					if (invitcode == "") {
						//alert("邀请码不能为空");
						toast({
							message: "邀请码不能为空",
							time: 1500
						});
						return false;
					}
					$.ajax({
						url: '__APP__/User/bind_invite_code_chk', //不跨域调取url
						type: 'post',
						data:{
							invitcode:invitcode
						},
						success: function(data) {
							console.log('data', data)
							var code = data.error_code;
							console.log('code', code);
							if (code == 0) {
								//alert("邀请码填写成功")
								toast({
									message: "邀请码填写成功",
									time: 1100
								});
								setTimeout(function() {
									window.location.href = "__APP__/User/usercenter"
								}, 1200);
							} else if (code ==1) {
								//alert("验证码不正确")
								toast({
									message: "验证码不正确",
									time: 1500
								});
							} else if (code == -101) {
								window.location.href = "__APP__/User/user_login"
							} 
						}
					});
				}
			</script>
</html>
